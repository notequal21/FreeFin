-- ============================================
-- Миграция: Добавление поля project_exchange_rate в transactions
-- Описание: Добавляет поле для хранения курса обмена к валюте проекта на момент создания транзакции
-- Это предотвращает пересчет старых транзакций при изменении курса по умолчанию
-- Дата: 2026-01-02
-- ============================================

-- Добавляем поле project_exchange_rate в таблицу transactions
-- Это курс обмена от primary_currency к валюте проекта на момент создания транзакции
ALTER TABLE public.transactions
ADD COLUMN IF NOT EXISTS project_exchange_rate numeric;

-- Комментарий к полю
COMMENT ON COLUMN public.transactions.project_exchange_rate IS 'Курс обмена от primary_currency к валюте проекта на момент создания транзакции. Используется для конвертации сумм в статистике проекта. NULL, если транзакция не связана с проектом или валюта проекта совпадает с primary_currency.';

